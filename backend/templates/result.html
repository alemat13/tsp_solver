<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Optimal Route Finder</title>
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='style.css') }}"
    />
    <link
      rel="stylesheet"
      href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
      integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
      crossorigin=""
    />
  </head>
  <body>
    <script
      src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
      integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
      crossorigin=""
    ></script>
    <h1>Optimal Route</h1>
    <p>The optimal route calculated is:</p>
    <ul id="gps_list"></ul>
    <div id="map"></div>
    <script>
      // Données du chemin optimal
      var optimalRoute = [
          {% for lat, lon in optimal_route %}
              [{{ lat }}, {{ lon }}],
          {% endfor %}
      ];

      var gps_list = document.getElementById('gps_list');
      for (var i = 0; i < optimalRoute.length; i++) {
          var li = document.createElement('li');
          li.innerHTML = optimalRoute[i][0] + ', ' + optimalRoute[i][1];
          gps_list.appendChild(li);
      }

      // Initialise la carte
      var map = L.map('map').setView([optimalRoute[0][0], optimalRoute[0][1]], 13);

      // Ajoute une couche de carte OpenStreetMap
      L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
          attribution: '© OpenStreetMap contributors'
      }).addTo(map);

      // Ajoute des marqueurs pour le chemin optimal
      for (var i = 0; i < optimalRoute.length; i++) {
          var marker = L.marker(optimalRoute[i]).addTo(map);
      }

      // Ajoute le trajet optimal
      var polyline = L.polyline(optimalRoute, {color: 'red'}).addTo(map);

    </script>
    <form action="/generate_kml" method="post">
      <textarea
        hidden="true"
        id="positions"
        name="positions"
        rows="4"
        cols="50"
      >
{{optimal_route_ta}}</textarea
      ><br />
      <input type="submit" value="Get KML" />
    </form>
  </body>
</html>
